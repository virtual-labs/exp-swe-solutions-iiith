(w=>{var p,t;function x(t,e){if(!t)throw e||"Assertion failed"}function g(t){for(var e=[],i=0;i<t;i++)e.push(0);return e}function d(t,e){for(var i=0,n=0;n<t.length;n++)i+=t.at(n).magnitudeSquared();i*=e;for(var r=1/(i=0===(i=Math.sqrt(i))?1:i),n=0;n<t.length;n++)t.set(n,t.at(n).multipliedByReal(r))}function i(t,e,i,n){for(var r=t.length,o=(x(0<r&&e<r,"center out of bounds"),w.ComplexArray.zeros(r)),s=o.res,a=o.ims,h=-e*i,l=i/Math.sqrt(2*Math.PI),u=-e*n,c=0;c<r;c++,u+=n){for(var p=Math.cos(-h*u),d=Math.sin(-h*u),f=Math.cos(-i*u),m=Math.sin(-i*u),g=0,v=0,y=0;y<r;y++)var _=t[y],_=(g+=_*p,v+=_*d,p*f-d*m),d=p*m+f*d,p=_;s[c]=l*g,a[c]=l*v}return o}(t=p=p||{})[t.Even=1]="Even",t[t.Odd=2]="Odd",w.assert=x,w.fourierTransformNaive=function(t,e,i,n){for(var r=t.length,o=(x(0<r&&e<r,"center out of bounds"),w.ComplexArray.zeros(r)),s=i/Math.sqrt(2*Math.PI),a=0;a<r;a++){for(var h=(a-e)*n,l=new w.Complex(0,0),u=0;u<r;u++){var c=t[u];l.addToSelf(w.Complex.exponential(-h*((u-e)*i)).multipliedByReal(c))}o.set(a,l.multipliedByReal(s))}return o},w.fourierTransform=i,n.prototype.valueAt=function(t,e){e=-this.md.energy*e;return this.values.at(t).multiplied(w.Complex.exponential(e))},n.prototype.fourierTransform=function(t,e){t=i(this.values.res,t,this.dx,this.dx*e);return d(t,this.dx),new n(t,this.dx,this.md)};var v=n;function n(t,e,i){this.values=t,this.dx=e,this.md=i,x(isFinite(i.energy),"Non-finite energy: "+i.energy),x(isFinite(e),"Non-finite dx: "+e),x(isFinite(i.leftDerivativeDiscontinuity),"Non-finite leftDerivativeDiscontinuity: "+i.leftDerivativeDiscontinuity),x(isFinite(i.rightDerivativeDiscontinuity),"Non-finite rightDerivativeDiscontinuity: "+i.rightDerivativeDiscontinuity)}function r(t){var e=this;x(0<(this.components=t).length,"Empty components in Wavefunction"),this.length=t[0].values.length,this.components.forEach(function(t){x(t.values.length===e.length,"Not all lengths the same")}),this.dx=this.components[0].dx}function o(t,e){x(t.values.length===e.values.length,"Wavefunctions have different lengths");var i=t.md.leftDerivativeDiscontinuity,n=e.md.leftDerivativeDiscontinuity;if(Math.abs(i)<.01)s=t.values.slice();else if(Math.abs(n)<.01)s=e.values.slice();else{for(var r=-i/n,o=t.values.length,s=w.ComplexArray.zeros(o),a=0;a<o;a++)s.set(a,t.values.at(a).added(e.values.at(a).multipliedByReal(r)));d(s,t.dx)}for(var h=s,i=t.md.leftTurningPoint,l=!1,u=i;u+1<h.length;u++){var c=h.at(u).re;if(1e-16<Math.abs(c)){l=c<0;break}}if(l)for(u=0;u<h.length;u++)h.set(u,h.at(u).multipliedByReal(-1));return new v(s,t.dx,t.md)}function s(t,e){for(var i,n=t.length,r=0;r<n&&!(e>t[r]);r++);for(i=n-1;r<=i&&!(e>t[i]);i--);return i<r&&(r=0,i=n-1),{left:r,right:i}}w.TimeIndependentWavefunction=v,r.prototype.valueAt=function(e,i){x(e===+e&&e===(0|e),"Non-integer passed to valueAt");var n=new w.Complex(0,0);return this.components.forEach(function(t){n.addToSelf(t.valueAt(e,i))}),n.re/=this.components.length,n.im/=this.components.length,n},r.prototype.fourierTransform=function(e,i){return new r(this.components.map(function(t){return t.fourierTransform(e,i)}))},w.Wavefunction=r,w.averageWavefunctionsToCancelDiscontinuities=o,w.classicalTurningPoints=s,e.prototype.length=function(){return x(this.valuesFromCenter.length===this.valuesFromEdge.length,"Wavefunction does not have a consistent length"),this.valuesFromCenter.length},e.prototype.derivativeDiscontinuity=function(t,e,i){return 0===e||e+1===t.length?0:(t[e+1]+t[e-1]-(14-12*this.F(e))*t[e])/i},e.prototype.resolveAtTurningPoints=function(t){for(var e=Math.round(t.left),i=Math.round(t.right),n=this.length(),r=(x(e<=i,"left is not <= right"),x(0<=e&&e<n&&0<=i&&i<n,"left or right out of bounds"),this.valuesFromCenter[e]/this.valuesFromEdge[e]),o=this.valuesFromCenter[i]/this.valuesFromEdge[i],s=g(n),a=0;a<e;a++)s[a]=r*this.valuesFromEdge[a];for(;a<i;a++)s[a]=this.valuesFromCenter[a];for(;a<n;a++)s[a]=o*this.valuesFromEdge[a];for(var t=this.maxX/n,h=s,l=t,u=0,c=0;c<h.length;c++)u+=h[c]*h[c];u*=l;for(var p=1/(u=0===(u=Math.sqrt(u))?1:u),c=0;c<h.length;c++)h[c]*=p;for(var l=this.derivativeDiscontinuity(s,e,t),d=this.derivativeDiscontinuity(s,i,t),l={energy:this.energy,leftTurningPoint:e,rightTurningPoint:i,leftDerivativeDiscontinuity:l,rightDerivativeDiscontinuity:d},f=w.ComplexArray.zeros(s.length),m=0;m<s.length;m++)f.res[m]=s[m];return new v(f,t,l)},e.prototype.resolveAtClassicalTurningPoints=function(){return this.resolveAtTurningPoints(s(this.potential,this.energy))};var f=e;function e(t,e,i){this.energy=e,this.maxX=i,this.valuesFromCenter=[],this.valuesFromEdge=[],this.F=null,this.potential=t.slice()}function h(t,e){function r(t){return 1-2*l*(n[t]-h)}function i(t,e,i){var n=i?e+1:e-1,i=i?e-1:e+1,e=((12-10*r(e))*t[e]-r(i)*t[i])/r(n);t[n]=isNaN(e)?0:e}var e=e===p.Even,n=t.potentialMesh,o=n.length,s=(x(3<=o,"PotentialMesh is too small"),m(n)),a=new f(n.slice(),t.energy,t.maxX),h=(a.valuesFromCenter=g(o),a.valuesFromEdge=g(o),t.energy),t=t.maxX/o,l=t*t/12,u=(a.F=r,a.valuesFromCenter);e?(u[s]=1,u[s+1]=.5*(12-10*r(s))*u[s]/r(s+1)):(u[s]=0,u[s+1]=t);for(var c=s+1;c+1<o;c++)i(u,c,!0);for(c=s;0<c;c--)i(u,c,!1);(u=a.valuesFromEdge)[0]=e?t:-t,u[1]=(12-10*r(0))*u[0]/r(1);for(c=1;c<s;c++)i(u,c,!0);u[o-1]=t,u[o-2]=(12-10*r(o-1))*u[o-1]/r(o-2);for(c=o-2;s<c;c--)i(u,c,!1);return a}function m(t){x(0<t.length,"No minimum for empty potential");for(var e=t.reduce(function(t,e){return Math.min(t,e)}),i=[],n=0;n<t.length;n++)t[n]===e&&i.push(n);x(0<i.length);var r=i[i.length/2|0],r=Math.max(1,r);return Math.min(t.length-2,r)}w.classicallyResolvedAveragedNumerov=function(t){var e=s(t.potentialMesh,t.energy);return o(h(t,p.Even).resolveAtTurningPoints(e),h(t,p.Odd).resolveAtTurningPoints(e))},w.indexOfMinimum=m,w.algorithmTest=function(){function t(t){return t.toFixed(2)}for(var e=[],i=1025,n=g(i),r=0;r<i;r++){var o=(a=r/i)-.5;n[r]=.04+o*o/2*12}var s=h({potentialMesh:n,energy:.5,maxX:25},p.Even).resolveAtClassicalTurningPoints();for(e.push("left discontinuity: "+s.md.leftDerivativeDiscontinuity.toFixed(4)),e.push("right discontinuity: "+s.md.rightDerivativeDiscontinuity.toFixed(4)),e.push("x\tpsi\tV"),r=0;r<i;r++){var a=r/i-.5;e.push(t(a)+"\t"+t(s.valueAt(r,0).re)+"\t"+t(n[r]))}return e.join("\n")}})(algorithms=algorithms||{}),(t=>{function i(t,e){if(!t)throw e||"Assertion failed"}function r(t,e){this.params=t,this.clients_=[],this.animating_=!1,this.rerenderScheduled_=!1,this.rerender_=e,this.elapsed_=0,this.lastNow_=r.now()}t.assert=i,t.vector3=function(t,e,i){return new THREE.Vector3(t,e,i)},r.now=function(){return(performance||Date).now()},r.prototype.scheduleRerender=function(){var t=this;this.rerenderScheduled_||(this.rerenderScheduled_=!0,window.requestAnimationFrame(function(){return t.fireClientsAndRerender()}))},r.prototype.addClient=function(t){this.clients_.push(t),this.scheduleRerender()},r.prototype.setAnimating=function(t){!this.animating_&&t&&(this.lastNow_=r.now(),this.scheduleRerender()),this.animating_=t},r.prototype.animating=function(){return this.animating_},r.prototype.reset=function(){this.elapsed_=0},r.prototype.fireClientsAndRerender=function(){var t,e,i=this,n=(this.rerenderScheduled_=!1,this.clients_.slice());this.animating_&&(e=((t=r.now())-this.lastNow_)/1e3,this.elapsed_+=e*this.params.timescale,this.lastNow_=t),n.forEach(function(t){return t.prepareForRender(i.elapsed_)}),this.rerender_(),this.animating_&&this.scheduleRerender()},t.Redrawer=r,e.prototype.xCenterForMeshIndex=function(t){i(0<=t&&t<this.meshDivision,"idx out of range");var e=this.width/this.meshDivision;return t*e+e/2},e.prototype.convertYToVisualCoordinate=function(t){return this.height*(1-t)},e.prototype.convertYFromVisualCoordinate=function(t){return 1-t/this.height},e.prototype.convertXToVisualCoordinate=function(t){return t/this.meshDivision*this.width};var s=e;function e(){this.width=800,this.height=600,this.cameraDistance=400,this.maxX=25,this.timescale=4,this.energyScale=5,this.frequencyScale=.5,this.meshDivision=800,this.psiScale=250,this.psiAbsScale=1.75*this.psiScale,this.psiColor=16766515,this.phiColor=30719}function n(t,e){void 0===e&&(e=function(){}),this.params_=t,this.applyStateUpdate=e,this.cameraRotationRadians=0,this.potentialBuilder=null,this.potential=[],this.potentialParameter=.15,this.sketching=!1,this.sketchLocations=[],this.showPsi=!0,this.showPsiAbs=!1,this.showPhi=!1,this.showPhiAbs=!1,this.paused=!1,this.energies={}}function a(t,e,i){for(var n=[],r=0;r<t.meshDivision;r++)n.push(i(r/t.meshDivision,e));return n}function h(t,e){for(var i=(new Date).getTime(),n=0;n<t;n++)e();return((new Date).getTime()-i)/t}function o(t){var e=new s,i=a(e,.15,function(t){t-=.5;return.25+t*t/2*.25}),n=algorithms.indexOfMinimum(i),i={potentialMesh:i,energy:2.5,maxX:e.maxX},e=algorithms.classicallyResolvedAveragedNumerov(i),i=t?1024:32,r="",o=e.values;return((t,e)=>{if(t.length==e.length){for(var i=0;i<t.length;i++){var n=t.at(i),r=e.at(i);if(1e-4<Math.abs(n.re-r.re))return;if(1e-4<Math.abs(n.im-r.im))return}return 1}})(algorithms.fourierTransformNaive(o.res,n,.1,.01),algorithms.fourierTransform(o.res,n,.1,.01))||(r+="fourierTransform produces wrong result\n"),r+="fourierTransform: "+h(i,function(){algorithms.fourierTransform(o.res,n,.1,.01)}).toFixed(2)+" ms     ",t||(r+="fourierTransformNaive: "+h(i,function(){algorithms.fourierTransformNaive(o.res,n,.1,.01)}).toFixed(2)+" ms"),r}t.Parameters=s,n.prototype.energyValues=function(){var e=this;return Object.keys(this.energies).map(function(t){return e.energies[t]})},n.prototype.copy=function(){var t,e=new n(this.params_);for(t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},n.prototype.rebuildPotentialIfNeeded=function(t){this.potentialBuilder?this.potentialParameter===t.potentialParameter&&this.potentialBuilder===t.potentialBuilder||(this.potential=a(this.params_,this.potentialParameter,this.potentialBuilder)):this.potential=[]},n.prototype.modify=function(t){var e=this.copy();t(e),e.rebuildPotentialIfNeeded(this),e.applyStateUpdate(e)},t.State=n,t.buildPotential=a,t.benchmark=function(){return o(!1)},t.runForProfiling=function(){return o(!0)}})(visualizing=visualizing||{}),(n=>{i.prototype.addToSelf=function(t){this.re+=t.re,this.im+=t.im},i.prototype.added=function(t){return new i(this.re+t.re,this.im+t.im)},i.prototype.multiplied=function(t){return new i(this.re*t.re-this.im*t.im,this.re*t.im+this.im*t.re)},i.prototype.multipliedByReal=function(t){return new i(this.re*t,this.im*t)},i.prototype.magnitudeSquared=function(){return this.re*this.re+this.im*this.im},i.prototype.toString=function(){return this.re.toFixed(2)+" + i*"+this.im.toFixed(2)},i.exponential=function(t){return new i(Math.cos(t),Math.sin(t))};var e=i;function i(t,e){this.re=t,this.im=e}function r(t){if(n.FloatArray==Float32Array||n.FloatArray==Float64Array)return new n.FloatArray(t);for(var e=[],i=0;i<t;i++)e.push(0);return e}function t(t){return n.FloatArray==Float32Array||n.FloatArray==Float64Array?new n.FloatArray(t):t.slice()}function o(t,e){this.res=t,this.ims=e,n.assert(t.length===e.length,"Mismatching length"),this.length=t.length}n.Complex=e,n.FloatArray=null,o.zeros=function(t){return n.assert(0<=t&&t===(0|t),"Invalid length"),new o(r(t),r(t))},o.prototype.at=function(t){return new e(this.res[t],this.ims[t])},o.prototype.set=function(t,e){this.res[t]=e.re,this.ims[t]=e.im},o.prototype.slice=function(){return new o(t(this.res),t(this.ims))},n.ComplexArray=o})(algorithms=algorithms||{}),(r=>{t.prototype.setEnergy=function(t){var e=this.params.convertYToVisualCoordinate(t);this.line.makeHorizontal(this.params.width,e),this.slider.setPosition(e),this.slider.setValue(t*this.params.energyScale)};var o=t;function t(t,e,i,n){this.identifier=t,this.slider=e,this.params=n,this.line=r.Polyline.create(2,i,{color:16711680})}function n(t,e,i){this.container=t,this.sliderPrototype=e,this.params=i,this.group=new THREE.Group,this.bars_={},this.state_=new r.State(this.params),r.assert(null!=this.container,"Energy slider could not find container"),r.assert(null!=this.sliderPrototype,"Energy slider could not find prototype")}n.prototype.nextInterestingEnergy=function(){var t=this.state_.energyValues();if(0==t.length)return.3;t.push(0,1),t.sort();for(var e=-1,i=-1,n=0;n+1<t.length;n++){var r=t[n+1]-t[n];i<r&&(e=t[n]+(i=r)/2)}return e},n.prototype.addEnergySlider=function(){var i=this.nextInterestingEnergy();this.state_.modify(function(t){var e=n.sNextEnergyBarIdentifier++;t.energies[e+""]=i})},n.prototype.removeEnergySlider=function(){var e,t=Object.keys(this.state_.energies).map(function(t){return parseInt(t,10)});1<t.length&&(e=t.reduce(function(t,e){return Math.max(t,e)}),this.state_.modify(function(t){delete t.energies[e]}))},n.prototype.setState=function(t){this.state_=t,this.applyStateToEnergyBars()},n.prototype.applyStateToEnergyBars=function(){var t,e=this,i=this.state_.energies;for(t in Object.keys(this.bars_).forEach(function(t){t in i||(e.tearDownEnergyBar(e.bars_[t]),delete e.bars_[t])}),i)t in this.bars_||(this.bars_[t]=this.makeEnergyBar(t)),this.bars_[t].setEnergy(i[t])},n.prototype.makeEnergyBar=function(i){var n=this,t=(r.assert(!(i in this.bars_),"Identifier already present in bars"),this.sliderPrototype.cloneNode(!0)),e=new ui.Slider(ui.Orientation.Vertical,t);return this.container.appendChild(t),t.style.display="inline-block",e.draggedToPositionHandler=function(t){var e=n.params.convertYFromVisualCoordinate(t);n.state_.modify(function(t){t.energies[i]=e})},new o(i,e,this.group,this.params)},n.prototype.tearDownEnergyBar=function(t){t.slider.remove(),t.line.remove()},n.sNextEnergyBarIdentifier=1,r.EnergyVisualizer=n})(visualizing=visualizing||{});var algorithms,tour,ui,visualizing,__extends=this&&this.__extends||(()=>{var n=function(t,e){return(n=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,e){t.__proto__=e}:function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}))(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}})();(n=>{(t=r=r||{})[t.None=0]="None",t[t.Native=1]="Native",t[t.Shader=2]="Shader";var r,o=void 0,t=(e.prototype.makeHorizontal=function(e,i){n.assert(2==this.length,"Line not of length 2"),this.update(function(t){return n.vector3(t*e,i,0)})},e.prototype.makeVertical=function(e,i){n.assert(2==this.length,"Line not of length 2"),this.update(function(t){return n.vector3(i,t*e,0)})},e.prototype.setVisible=function(t){this.object.visible=t},e.prototype.setRenderOrder=function(t){this.object.renderOrder=t},e.prototype.remove=function(){this.parent&&(this.parent.remove(this.object),this.parent=null)},e.create=function(t,e,i){var n=o=void 0===o?0<=window.location.search.indexOf("lines=native")?r.Native:0<=window.location.search.indexOf("lines=shader")?r.Shader:r.None:o,n=new((n=n==r.None?2==t?r.Native:r.Shader:n)===r.Native?a:h)(t,i);return e&&(n.parent=e).add(n.object),n},e);function e(t){this.length=t,this.parent=null}n.Polyline=t,__extends(i,s=t),i.prototype.update=function(t){for(var e=0;e<this.length;e++)this.geometry.vertices[e]=t(e);this.geometry.verticesNeedUpdate=!0};var s,a=i;function i(t,e){for(var i=s.call(this,t)||this,n=(i.geometry=new THREE.Geometry,new THREE.Vector3(0,0,0)),r=0;r<t;r++)i.geometry.vertices.push(n);return i.line=new THREE.Line(i.geometry,new THREE.LineBasicMaterial(e)),i.object=i.line,i}__extends(l,d=t),l.prototype.update=function(t){var e=this.geometry.attributes;function i(t,e,i){var e=6*e,n=i.x,r=i.y,i=i.z;t[e++]=n,t[e++]=r,t[e++]=i,t[e++]=n,t[e++]=r,t[+e]=i}for(var n=e.position.array,r=e.prev.array,o=e.next.array,s=this.length-1,a=0;a<this.length;a++){var h=t(a);i(n,a,h),0<a&&i(o,a-1,h),a<s&&i(r,a+1,h),0===a&&i(r,a,h),a===s&&i(o,a,h)}e.position.needsUpdate=!0,e.next.needsUpdate=!0,e.prev.needsUpdate=!0};var d,h=l;function l(t,e){for(var i=d.call(this,t)||this,n=(i.geometry=new THREE.BufferGeometry,2*t),r=new Float32Array(3*n),r=(i.geometry.addAttribute("position",new THREE.BufferAttribute(r,3)),Math.max(1,e.linewidth||0)),o=!e.hasOwnProperty("depthWrite")||e.depthWrite,s=new Uint32Array(3*(2*(t-1))),a=0,h=0;h+1<t;h++){var l=2*h;s[a++]=0+l,s[a++]=1+l,s[a++]=2+l,s[a++]=2+l,s[a++]=1+l,s[a++]=3+l}i.geometry.setIndex(new THREE.BufferAttribute(s,1));for(var u=new Float32Array(n),h=0;h<n;h++)u[h]=1&h?-1:1;i.geometry.addAttribute("direction",new THREE.BufferAttribute(u,1));var c=new Float32Array(3*n),p=new Float32Array(3*n),c=(i.geometry.addAttribute("next",new THREE.BufferAttribute(c,3)),i.geometry.addAttribute("prev",new THREE.BufferAttribute(p,3)),new THREE.ShaderMaterial({side:THREE.DoubleSide,uniforms:{color:{type:"c",value:new THREE.Color(e.color)},thickness:{type:"f",value:r}},vertexShader:f.vertexCode,fragmentShader:f.fragmentCode,depthWrite:o}));return c.transparent=!0,i.mesh=new THREE.Mesh(i.geometry,c),i.object=i.mesh,i}n.PolylineShader=h;var f={fragmentCode:"\n            uniform vec3 color;\n            varying float projectedDepth; // depth of the corresponding vertex\n            varying float edgeiness;\n\n            void main() {\n                float cameraDistance = 400.0;\n                float psiScale = 250.0; // maximum size of psi\n                float totalScale = psiScale * .5; // maximum distance that psi can be from its baseline\n                float depthScale = smoothstep(-totalScale, totalScale, cameraDistance - projectedDepth);\n                \n                vec3 mungedColor = color * (1.0 + depthScale) / 2.0;\n                float alpha = 1.0 - pow(abs(edgeiness), 4.0);\n                gl_FragColor = vec4(mungedColor, alpha);\n            }\n        ",vertexCode:"\n            attribute float direction;\n            uniform float thickness;\n            attribute vec3 next;\n            attribute vec3 prev;\n            varying float projectedDepth;\n            varying float edgeiness;\n            \n            void main() {\n                float aspect = 800.0 / 600.0;\n                vec2 aspectVec = vec2(aspect, 1.0);\n                mat4 projViewModel = projectionMatrix * modelViewMatrix;\n                \n                // Project all of our points to model space\n                vec4 previousProjected = projViewModel * vec4(prev, 1.0);\n                vec4 currentProjected = projViewModel * vec4(position, 1.0);\n                vec4 nextProjected = projViewModel * vec4(next, 1.0);\n                \n                // Pass the projected depth to the fragment shader\n                projectedDepth = currentProjected.w;                \n\n                // Get 2D screen space with W divide and aspect correction\n                vec2 currentScreen = currentProjected.xy / currentProjected.w * aspectVec;\n                vec2 previousScreen = previousProjected.xy / previousProjected.w * aspectVec;\n                vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n                                \n                // Use the average of the normals\n                // This helps us handle 90 degree turns correctly\n                vec2 tangent1 = normalize(nextScreen - currentScreen);\n                vec2 tangent2 = normalize(currentScreen - previousScreen);\n                vec2 averageTangent = normalize(tangent1 + tangent2);\n                vec2 normal = vec2(-averageTangent.y, averageTangent.x);\n                normal *= thickness/2.0;\n                normal.x /= aspect;\n\n                edgeiness = direction;\n                \n                // Offset our position along the normal\n                vec4 offset = vec4(normal * direction, 0.0, 1.0);\n                gl_Position = currentProjected + offset;\n            }\n        "}})(visualizing=visualizing||{}),(c=>{function p(t,e,i){var n;return t.x>e.x&&(n=t,t=e,e=n),i<=t.x?t.y:i>=e.x?e.y:(n=(i-t.x)/(e.x-t.x),t.y*(1-n)+e.y*n)}function i(t){return t<=.5?t:1-t}c.Infinityish=1e3,c.smoothstep=p,c.SimpleHarmonicOscillator=function(t,e){e=i(e)-.5,t-=.5;return.04+Math.min(1e5,.96/(e*e/2))*(t*t/2)},c.InfiniteSquareWell=function(t,e){e=i(e);return t<e||1-e<t?c.Infinityish:.05},c.FiniteSquareWell=function(t,e){e=i(e);return t<e||1-e<t?.8:.05},c.TwoSquareWells=function(t,e){e=i(e);return t<e||1-e<=t?c.Infinityish:!((t=(t-e)/(1-2*e))<1/3.5)&&(t-=1/3.5)<.1?.85:.05},c.SteppedSquareWell=function(t,e){e=i(e);return t<e||1-e<t?c.Infinityish:t<.5?.4:.05},c.SampledPotential=function(o){return c.assert(0<o.length),function(t){for(var e,i=0,n=!1,r=1;r<o.length;r++)t>o[r-1].x!=t>o[r].x&&(e=p(o[r-1],o[r],t),i=Math.max(i,e),n=!0);return n?i:c.Infinityish}},c.RandomPotential=function(){var t=Math.floor(16*Math.random()+8);function e(){switch(5*Math.random()|0){case 0:return"line";case 1:return"flat";default:return"bezier"}}var u=[];u.push({x:0,y:1,joinType:"line"});for(var i=0;i<t;i++)u.push({x:.95*Math.random(),y:Math.pow(Math.random(),1.5),joinType:e(),control:Math.random()});for(u.sort(function(t,e){return t.x-e.x}),i=1;i<u.length;i++)u[i].x-u[i-1].x<.1&&(u.splice(i,1),i--);for(var n=u[u.length-2];"flat"==n.joinType;)n.joinType=e();return u.push({x:1,y:1,joinType:"line"}),function(t){var e=((t,e)=>{c.assert(0<t.length);for(var i=0,n=t.length;i+1<n;){var r=i+(n-i)/2|0;t[r].x<=e?i=r:n=r}return i})(u,t),i=e+1,n=u[e];if(!(u.length<=i)){var r,o,s,a=u[i];switch(n.joinType){case"square":return n.y;case"line":return p(n,a,t);case"bezier":var h=n.control,l=(t-n.x)/(a.x-n.x);return r=n.y,o=a.y,(s=1-l)*(s*r+l*h)+l*(s*h+l*o)}}return n.y}}})(algorithms=algorithms||{}),(r=>{function t(t){this.params=t,this.group=new THREE.Group,this.state_=new r.State(this.params),this.potentialLine_=r.Polyline.create(this.params.meshDivision,this.group,{color:16711935,linewidth:5,depthWrite:!1}),this.potentialLine_.setRenderOrder(-5e3),this.sketchLine_=r.Polyline.create(this.params.meshDivision,this.group,{color:65535,linewidth:8});var t=new THREE.PlaneGeometry(2*this.params.width,2*this.params.height),e=new THREE.MeshBasicMaterial({visible:!1,depthWrite:!1}),t=(this.background_=new THREE.Mesh(t,e),this.background_.position.set(this.params.width/2,this.params.height/2,0),this.background_.renderOrder=-1e4,this.group.add(this.background_),Math.max(this.params.width,this.params.height));this.sketchGrid_=new THREE.GridHelper(t,20),this.sketchGrid_.setColors(0,25477),this.sketchGrid_.renderOrder=-9999,this.sketchGrid_.rotation.x=Math.PI/2,this.group.add(this.sketchGrid_)}t.prototype.setState=function(t){this.state_=t,this.sketchGrid_.visible=this.state_.sketching,this.setDrawTextShown(t.sketching&&0==t.sketchLocations.length),this.redrawPotentialLine(),this.redrawSketchLine()},t.prototype.redrawSketchLine=function(){var e=this,t=0<this.state_.sketchLocations.length;this.sketchLine_.setVisible(t),t&&this.sketchLine_.update(function(t){t=Math.min(t,e.state_.sketchLocations.length-1);return e.state_.sketchLocations[t]})},t.prototype.redrawPotentialLine=function(){var i=this,n=this.state_.potential,t=0<n.length;this.potentialLine_.setVisible(t),t&&(r.assert(n.length==this.params.meshDivision,"Bad potential length"),this.potentialLine_.update(function(t){var e=n[t],t=i.params.xCenterForMeshIndex(t),e=i.params.convertYToVisualCoordinate(e);return r.vector3(t,e,0)}))},t.prototype.setDrawTextShown=function(t){document.getElementById("draw-text").style.visibility=t?"visible":"hidden"},t.prototype.dragStart=function(t){this.state_.sketching&&this.state_.modify(function(t){t.sketchLocations=[]})},t.prototype.dragged=function(t){var e;this.state_.sketching&&0<(t=t.intersectObject(this.background_,!1)).length&&(t=t[0].point,e=r.vector3(t.x+this.params.width/2,t.y+this.params.height/2,0),this.state_.modify(function(t){t.sketchLocations=t.sketchLocations.concat([e])}))},t.prototype.dragEnd=function(){var e,i=this;this.state_.sketching&&(e=this.state_.sketchLocations.map(function(t){return{x:t.x/i.params.width,y:1-t.y/i.params.height}}),this.state_.modify(function(t){t.sketching=!1,t.sketchLocations=[],0<e.length&&(t.potentialBuilder=algorithms.SampledPotential(e))}))},t.prototype.hitTestDraggable=function(t){return 0<t.intersectObject(this.background_,!1).length?this:null},r.PotentialVisualizer=t})(visualizing=visualizing||{}),(t=>{var e=null;function i(){e=null}t.stop=function(){null!==e&&e.exit()},t.start=function(){var t;null===e&&((e=introJs()).oncomplete(i).onexit(i).setOptions({showBullets:!1,showStepNumbers:!1,highlightClass:"dimmer-highlight",tooltipClass:"tour-tooltip",nextLabel:"Next &rarr;",prevLabel:"&larr; Back",steps:[{element:null,intro:(t="All&nbsp;aboard&nbsp;the&nbsp;quantum&nbsp;tour&nbsp;bus!<br><br>",void 0!==window.orientation?t+="Touch anywhere else on the site to exit the bus.":t+="The left and right arrow keys step forwards and backwards.<br><br>Click anywhere else on the site to exit the bus.",t),position:"right"},{element:"#vis-container",intro:'Here\'s where the action happens!<br><br>The visualizer shows the <i style="color: #FFD633">wavefunction</i>, <i style="color: magenta">potential</i>, and <i style="color: red">energy</i>.',position:"right"},{element:"#energy-dragging-container",intro:"Adjust the energy by dragging this slider up and down. Try it now!<br><br>You can add more energies with the +/- buttons at the bottom.",position:"right"},{element:"#potential-dragging-container",intro:"Adjust the width of the potential by dragging this slider left and right. Try it now!",position:"bottom"},{element:"#potential_chooser",intro:"Use the V to select from a list of potentials, or to create your own.",position:"right"},{element:"#psi_container",intro:"Toggle the wavefunction and its squared modulus. This shows <i>position</i>.",position:"right"},{element:"#phi-container",intro:"Toggle the momentum-space wavefunction and its squared modulus. This shows <i>momentum</i>.",position:"right"},{element:(t=>{t.startsWith("#")&&(t=t.slice(1));for(var e=document.getElementsByTagName("label"),i=0;i<e.length;i++)if(e[i].htmlFor===t)return e[i];return null})("#check_paused"),intro:"Play or pause the animation.",position:"left"},{element:"#rotator",intro:"Grab and spin to rotate around the Y axis. Try it now!",position:"left"},{element:"#energy_buttons",intro:"Add and remove energies.",position:"left"},{element:null,intro:'Play around, or <a class="light-link" href="javascript:tryExercises()">try the exercises</a> in the text</a>.<br><br>Happy SchrÃ¶dingering!',position:"right"}]}),e.start())}})(tour=tour||{}),(t=>{function n(t){t?document.body.classList.add("noselect"):document.body.classList.remove("noselect");for(var e=document.getElementsByTagName("iframe"),i=0;i<e.length;i++)t?e[i].classList.add("no-pointer-events"):e[i].classList.remove("no-pointer-events")}function u(t){var e=null;return{x:(e=t.targetTouches?t.targetTouches[0]:t).pageX,y:e.pageY}}var e,i;function r(t,e){this.orientation=t,this.element=e,this.unconstrainedPosition=-1,this.position=0,this.draggedToPositionHandler=function(){},r.globalInitDone||(r.globalInitDone=!0,document.addEventListener("mousemove",function(t){r.draggedSlider&&r.draggedSlider.tryDrag(t)}),document.addEventListener("mouseup",function(){r.draggedSlider&&r.draggedSlider.stopDragging()})),this.installEventHandlers()}t.setupRotatorKnob=function(s,a){function t(t){if(h){var e=u(t),i=s.getBoundingClientRect(),n=e.x-i.left-i.width/2,e=e.y-i.top-i.height/2;if(0!=n&&0!=e){l=Math.atan2(e,n);for(var r=-2;r<=2;r++){var o=r*Math.PI/2;if(Math.abs(l-o)<.1){l=o;break}}l+=Math.PI/2,s.style.transform="rotate("+l+"rad)",a&&a(l)}t.stopPropagation(),t.preventDefault()}}function e(){h||(h=!0,document.body.classList.add("noselect"),document.addEventListener("mousemove",t),document.addEventListener("touchmove",t),n(!0))}function i(){h&&(h=!1,document.removeEventListener("mousemove",t),document.removeEventListener("touchmove",t),n(!1))}var h=!1,l=0;s.addEventListener("mousedown",e),s.addEventListener("touchstart",e),document.addEventListener("mouseup",i),s.addEventListener("touchend",i),s.addEventListener("touchcancel",i)},(i=e=t.Orientation||(t.Orientation={}))[i.Horizontal=0]="Horizontal",i[i.Vertical=1]="Vertical",r.prototype.remove=function(){this.removeEventHandlers();var t=this.element.parentNode;t&&t.removeChild(this.element)},r.prototype.setPosition=function(t){this.position=t,this.isHorizontal()?this.element.style.left=t+"px":this.element.style.top=t+"px"},r.prototype.setValue=function(t){for(var e=t.toFixed(2),i=this.element.getElementsByClassName("value_text"),n=0;n<i.length;n++)i[n].textContent=e},r.prototype.setVisible=function(t){this.element.style.visibility=t?"visible":"hidden"},r.prototype.eventTargets=function(){function t(t){return e.element.getElementsByClassName(t)[0]}var e=this;return{touch:t("touch_event_target"),click:t("click_event_target")}},r.prototype.installEventHandlers=function(){var e=this,t=this.eventTargets(),i=t.touch,t=t.click;t.onmousedown=function(t){return e.startDragging(t)},Array(i,t).forEach(function(t){t.ontouchstart=function(t){return e.startDragging(t)},t.ontouchmove=function(t){return e.tryDrag(t)},t.ontouchend=function(){return e.stopDragging()},t.ontouchcancel=function(){return e.stopDragging()}})},r.prototype.removeEventHandlers=function(){var t=this.eventTargets(),e=t.touch;Array(e,t.click).forEach(function(t){t.onmousedown=null,t.ontouchstart=null,t.ontouchmove=null,t.ontouchend=null,t.ontouchcancel=null})},r.prototype.startDragging=function(t){r.draggedSlider=this,r.lastPosition=this.getEventPosition(t),this.unconstrainedPosition=this.position,t.preventDefault()},r.prototype.stopDragging=function(){r.draggedSlider=null},r.prototype.tryDrag=function(t){var e,i;this===r.draggedSlider&&(t.preventDefault(),e=(t=this.getEventPosition(t))-r.lastPosition,e*=(i=this.container()).offsetHeight/i.getBoundingClientRect().height,r.lastPosition=t,this.unconstrainedPosition+=e,i=this.isHorizontal()?this.container().offsetWidth:this.container().offsetHeight,t=Math.min(Math.max(this.unconstrainedPosition,0),i),this.draggedToPositionHandler(t))},r.prototype.container=function(){return this.element.parentElement||this.element},r.prototype.isHorizontal=function(){return this.orientation==e.Horizontal},r.prototype.getEventPosition=function(t){var e=this.isHorizontal()?this.container().offsetLeft:this.container().offsetTop,t=u(t);return(this.isHorizontal()?t.x:t.y)-e},r.draggedSlider=null,r.lastPosition=-1,r.globalInitDone=!1,t.Slider=r,t.initDragging=function(i,n,r){function o(t){var e=(t=l(t)).x/i.offsetWidth*2-1,e=new THREE.Vector2(e,t.y/i.offsetHeight*2-1);return(t=new THREE.Raycaster).setFromCamera(e,n),t}function t(t){h&&a&&(a.dragged(o(t)),t.preventDefault())}function e(t){a=null;for(var e=o(t),i=0;i<r.length&&null===a;i++)a=r[i].hitTestDraggable(e);a&&a.dragStart(e),h=!0}function s(){a&&(a.dragEnd(),a=null,h=!1)}var a=null,h=!1,l=function(t){var e=(t=>{for(var e={x:0,y:0},i=t;null!=i;)e.x+=i.offsetLeft,e.y+=i.offsetTop,i=i.offsetParent;return e})(i),t=u(t);return{x:t.x-e.x,y:t.y-e.y}};i.addEventListener("mousemove",t),i.addEventListener("touchmove",t),i.addEventListener("mousedown",e),i.addEventListener("touchstart",e),document.addEventListener("mouseup",s),document.addEventListener("touchend",s),document.addEventListener("touchcancel",s)};var s=551,a=486,h=null,l=null,c=null;t.resizeToFitWindowHeight=function(){var t,e,i,n=document.getElementById("ui-scale-target"),r=document.getElementById("ui-container"),o=(null===l&&(l=n.offsetWidth,c=n.offsetHeight),c);i=window.innerHeight,90!==window.orientation&&-90!==window.orientation||(i===s&&(i=a),(null===h||i<h)&&(h=i),i=Math.min(i,h)),o<=i?(n.style.transform=null,r.style.marginRight=null,r.style.marginBottom=null):(t=i,t=Math.max(i,400),i=(t=Math.min(t,o))/o,e="translate("+(o=l/c*(t=(t-o)/2))+"px,"+t+"px)",n.style.transform=e+=" scale("+i+","+i+")",r.style.marginRight=Math.floor(2*o)+"px",r.style.marginBottom=Math.floor(2*t)+"px")}})(ui=ui||{}),(a=>{function t(t,e,i,n){var r=this,o=(this.params_=new a.Parameters,this.state_=new a.State(this.params_,function(t){return r.setState(t)}),this.topScene_=new THREE.Scene,this.group_=new THREE.Group,new THREE.WebGLRenderer({antialias:!1})),s=(o.setClearColor(2236962,1),o.setSize(t.offsetWidth,t.offsetHeight),t.appendChild(o.domElement),Math.atan2(this.params_.height,this.params_.width)*(180/Math.PI)*2),s=Math.ceil(s),s=(this.camera_=new THREE.PerspectiveCamera(s,this.params_.width/this.params_.height,50,1e3),this.group_.position.x=-this.params_.width/2,this.group_.position.y=this.params_.height/2,this.group_.scale.y=-1,this.topScene_.add(this.group_),this.animator_=new a.Redrawer(this.params_,function(){o.render(r.topScene_,r.camera_)}),this.potentialSlider_=new ui.Slider(ui.Orientation.Horizontal,e),this.potentialSlider_.draggedToPositionHandler=function(e){r.state_.modify(function(t){t.potentialParameter=e/r.params_.width})},this.potentialVisualizer_=new a.PotentialVisualizer(this.params_),this.group_.add(this.potentialVisualizer_.group),this.wavefunctionAvg_=new a.WavefunctionVisualizer(this.params_,this.animator_),this.params_.height/2),e=(this.wavefunctionAvg_.group.position.y=s,this.group_.add(this.wavefunctionAvg_.group),this.energyVisualizer_=new a.EnergyVisualizer(i,n,this.params_),this.group_.add(this.energyVisualizer_.group),{color:10066329,linewidth:1,transparent:!0,opacity:.5});this.leftTurningPointLine_=a.Polyline.create(2,this.group_,e),this.rightTurningPointLine_=a.Polyline.create(2,this.group_,e),ui.initDragging(t,this.camera_,[this.potentialVisualizer_])}t.prototype.applyCameraRotation=function(){var t=this.state_.cameraRotationRadians,e=this.params_.cameraDistance,i=Math.sin(t)*e,t=Math.cos(t)*e;this.camera_.position.set(i,0,t),this.camera_.lookAt(new THREE.Vector3(0,0,0))},t.prototype.applyStateToWavefunction=function(){var e,t,i,n=this;0===this.state_.potential.length?this.wavefunctionAvg_.setWavefunction(null):(0<(i=this.state_.energyValues()).length&&(e=[],i.forEach(function(t){t={potentialMesh:n.state_.potential,energy:t,maxX:n.params_.maxX},t=algorithms.classicallyResolvedAveragedNumerov(t);e.push(t)}),t=new algorithms.Wavefunction(e),this.wavefunctionAvg_.setWavefunction(t)),t=i.reduce(function(t,e){return Math.max(t,e)},0),i=algorithms.classicalTurningPoints(this.state_.potential,t),t=this.params_.convertXToVisualCoordinate(i.left),i=this.params_.convertXToVisualCoordinate(i.right),this.leftTurningPointLine_.makeVertical(this.params_.height,t),this.rightTurningPointLine_.makeVertical(this.params_.height,i))},t.prototype.setState=function(t){this.state_=t,this.potentialVisualizer_.setState(t),this.wavefunctionAvg_.setState(t),this.energyVisualizer_.setState(t),this.potentialSlider_.setPosition(t.potentialParameter*this.params_.width),this.potentialSlider_.setVisible(t.potentialBuilder&&1<t.potentialBuilder.length),this.applyStateToWavefunction(),this.applyCameraRotation(),this.animator_.setAnimating(!t.paused),this.animator_.scheduleRerender()},t.prototype.loadPotentialFromBuilder=function(e){this.state_.modify(function(t){t.sketching=!1,t.sketchLocations=[],t.potentialBuilder=e})},t.prototype.setShowPsi=function(e){this.state_.modify(function(t){return t.showPsi=e})},t.prototype.setShowPsiAbs=function(e){this.state_.modify(function(t){return t.showPsiAbs=e})},t.prototype.setShowPhi=function(e){this.state_.modify(function(t){return t.showPhi=e})},t.prototype.setShowPhiAbs=function(e){this.state_.modify(function(t){return t.showPhiAbs=e})},t.prototype.setPaused=function(e){e&&this.animator_.reset(),this.state_.modify(function(t){return t.paused=e})},t.prototype.setRotation=function(e){this.state_.modify(function(t){return t.cameraRotationRadians=e})},t.prototype.loadSHO=function(){this.loadPotentialFromBuilder(algorithms.SimpleHarmonicOscillator)},t.prototype.loadISW=function(){this.loadPotentialFromBuilder(algorithms.InfiniteSquareWell)},t.prototype.loadFSW=function(){this.loadPotentialFromBuilder(algorithms.FiniteSquareWell)},t.prototype.load2SW=function(){this.loadPotentialFromBuilder(algorithms.TwoSquareWells)},t.prototype.loadSteppedSW=function(){this.loadPotentialFromBuilder(algorithms.SteppedSquareWell)},t.prototype.loadRandomPotential=function(){this.loadPotentialFromBuilder(algorithms.RandomPotential())},t.prototype.addEnergySlider=function(){this.energyVisualizer_.addEnergySlider()},t.prototype.removeEnergySlider=function(){this.energyVisualizer_.removeEnergySlider()},t.prototype.sketchPotential=function(){this.state_.modify(function(t){t.potential=[],t.potentialBuilder=null,t.sketching=!0})},a.Visualizer=t})(visualizing=visualizing||{}),(s=>{function a(i){return function(t,e){t=i(t,e).magnitudeSquared();return new algorithms.Complex(t,0)}}function t(t,e){var i=this,e=(this.params=t,this.animator=e,this.group=new THREE.Group,this.state_=new s.State(this.params),t.psiColor),t=t.phiColor,n={color:e,linewidth:5,depthTest:!1},r={color:e,linewidth:8,transparent:!0,opacity:.75,depthTest:!1},o={color:t,linewidth:5,transparent:!0,opacity:.75,depthTest:!1},t={color:t,linewidth:8,transparent:!0,opacity:.75,depthTest:!1};this.psiBaseline_=s.Polyline.create(2,this.group,{color:e,linewidth:.5,depthTest:!1}),this.psiBaseline_.update(function(t){return s.vector3(t*i.params.width,0,0)}),this.psiVis_=new h(this.params.psiScale,this.params,this.group,n),this.phiVis_=new h(this.params.psiScale,this.params,this.group,o),this.psiAbsVis_=new h(this.params.psiAbsScale,this.params,this.group,r),this.phiAbsVis_=new h(this.params.psiAbsScale,this.params,this.group,t),this.animator.addClient(this)}t.prototype.setState=function(t){this.state_=t,this.psiVis_.visible=this.state_.showPsi,this.psiAbsVis_.visible=this.state_.showPsiAbs,this.phiVis_.visible=this.state_.showPhi,this.phiAbsVis_.visible=this.state_.showPhiAbs},t.prototype.setWavefunction=function(i){var t,n,e,r,o=this;i?(s.assert(i.length===this.params.meshDivision,"Wavefunction has wrong length"),t=null,n=function(){return t=null===t?i.fourierTransform(Math.floor(i.length/2),o.params.frequencyScale):t},r=function(t,e){return n().valueAt(t,e)},this.psiVis_.valueAt=e=function(t,e){return i.valueAt(t,e)},this.psiAbsVis_.valueAt=a(e),this.phiVis_.valueAt=r,this.phiAbsVis_.valueAt=a(r)):(this.psiVis_.valueAt=null,this.psiAbsVis_.valueAt=null,this.phiVis_.valueAt=null,this.phiAbsVis_.valueAt=null)},t.prototype.prepareForRender=function(t){this.psiVis_.update(t),this.psiAbsVis_.update(t),this.phiVis_.update(t),this.phiAbsVis_.update(t)},s.WavefunctionVisualizer=t,e.prototype.update=function(n){var r=this;this.visible&&null!==this.valueAt?(this.line_.setVisible(!0),this.line_.update(function(t){var e=r.params_.xCenterForMeshIndex(t),t=r.valueAt(t,n),i=-r.scale*t.re,t=r.scale*t.im;return s.vector3(e,r.clamp(i),r.clamp(t))})):this.line_.setVisible(!1)},e.prototype.clamp=function(t){var e=this.params_.height/2;return isNaN(t)&&(t=e),Math.max(-e,Math.min(e,t))};var h=e;function e(t,e,i,n){this.scale=t,this.params_=e,this.valueAt=null,this.visible=!0,this.line_=s.Polyline.create(this.params_.meshDivision,i,n)}})(visualizing=visualizing||{});